<!DOCTYPE HTML>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Go SmallStruct Serializers Benchmark Results</title>

	<!-- Bootstrap CSS -->
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

	<!-- jQuery, Popper.js, Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

	<!-- DataTables CSS and JS -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
	<script type="text/javascript" charset="utf8"
		src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>

	<!-- Report Data-->
	<script src="data.js"></script>

	<!-- Custom CSS -->
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 20px;
		}

		.note {
			font-style: italic;
			margin-bottom: 20px;
		}

		.dataTables_wrapper .dataTables_filter input {
			margin-left: 0.5em;
		}

		.dataTables_length select {
			margin-right: 0.5em;
		}

		.yes {
			background-color: #d4edda !important;
			color: #155724 !important;
		}

		.no {
			background-color: #f8d7da !important;
			color: #721c24 !important;
		}

		.column-toggle {
			display: grid;
			column-gap: 0.375rem;
			grid-template-columns: repeat(2, minmax(0, 1fr));
		}

		.filter-toggle {
			margin-bottom: 20px;
		}

		.toggle-container {
			display: flex;
			gap: 15px;
			margin-bottom: 20px;
			transition: all 0.3s ease;
			max-height: 640px;
			overflow: hidden;
		}

		.toggle-container.collapsed {
			max-height: 0;
			margin-bottom: 20px;
			padding-top: 0;
			padding-bottom: 0;
		}

		.toggle-container h5 {
			margin-bottom: 10px;
		}

		.toggle-container label {
			display: flex;
			align-items: center;
		}

		.toggle-container input {
			margin-right: 5px;
		}

		.custom-select {
			width: 200px;
			margin-bottom: 10px;
		}
	</style>
</head>

<body>
	<p class="note">
		Note: This report is user-generated. For best comparison results, re-run it on your target
		architecture/platform.
	</p>

	<h2>Go SmallStruct Serializers Benchmark Results</h2>

	<button id="toggleColumnsBtn" class="btn btn-primary mb-3">Filter Benchmarks</button>

	<div class="toggle-container collapsed">
		<h5>Show/Hide Columns:</h5>
		<div class="column-toggle">
			<label><input type="checkbox" data-column="0" checked>Name</label>
			<label><input type="checkbox" data-column="1" checked>Total Iterations</label>
			<label><input type="checkbox" data-column="2">Marshal Iterations</label>
			<label><input type="checkbox" data-column="3">Unmarshal Iterations</label>
			<label><input type="checkbox" data-column="4" checked>Total ns/Op</label>
			<label><input type="checkbox" data-column="5">Marshal ns/Op</label>
			<label><input type="checkbox" data-column="6">Unmarshal ns/Op</label>
			<label><input type="checkbox" data-column="7" checked>Total B/Op</label>
			<label><input type="checkbox" data-column="8">Marshal B/Op</label>
			<label><input type="checkbox" data-column="9">Unmarshal B/Op</label>
			<label><input type="checkbox" data-column="10" checked>Total allocs/Op</label>
			<label><input type="checkbox" data-column="11">Marshal allocs/Op</label>
			<label><input type="checkbox" data-column="12">Unmarshal allocs/Op</label>
			<label><input type="checkbox" data-column="13" checked>Serialization Size</label>
			<label><input type="checkbox" data-column="14" checked>Unsafe Str Unmarshal</label>
			<label><input type="checkbox" data-column="15" checked>Buffer Reuse Marshal</label>
			<label><input type="checkbox" data-column="16" checked>Time Support</label>
			<label><input type="checkbox" data-column="17" checked>API Kind</label>
			<label><input type="checkbox" data-column="18" checked>URL</label>
			<label><input type="checkbox" data-column="19" checked>Notes</label>
		</div>

		<h5>Filter Benchmarks:</h5>
		<div class="filter-toggle">
			<label><input type="checkbox" id="filterUnsafe" checked>Show Unsafe Str Unmarshal</label>
			<label><input type="checkbox" id="filterBuffer" checked>Show Buffer Reuse Marshal</label>

			<label>Filter by Time Support:</label>
			<select class="custom-select" id="timeSupportFilter">
				<option value="">All</option>
				<option value="unix-ns">unix-ns</option>
				<option value="unix-ms">unix-ms</option>
				<option value="fullrange">fullrange</option>
				<option value="fulltzoffset">fulltzoffset</option>
				<option value="RFC3339ns">RFC3339ns</option>
				<option value="custom">custom</option>
				<option value="no">no</option>
				<option value="unknown">unknown</option>
			</select>

			<label>Filter by API Kind:</label>
			<select class="custom-select" id="apiKindFilter">
				<option value="">All</option>
				<option value="reflect">reflect</option>
				<option value="codegen">codegen</option>
				<option value="manual">manual</option>
			</select>
		</div>
	</div>

	<table id="benchmarkResults" class="display table table-striped table-bordered">
		<thead>
			<tr>
				<th>Name</th>
				<th>Total Iterations</th>
				<th>Marshal Iterations</th>
				<th>Unmarshal Iterations</th>
				<th>Total ns/Op</th>
				<th>Marshal ns/Op</th>
				<th>Unmarshal ns/Op</th>
				<th>Total B/Op</th>
				<th>Marshal B/Op</th>
				<th>Unmarshal B/Op</th>
				<th>Total allocs/Op</th>
				<th>Marshal allocs/Op</th>
				<th>Unmarshal allocs/Op</th>
				<th>Serialization Size</th>
				<th>Unsafe Str Unmarshal</th>
				<th>Buffer Reuse Marshal</th>
				<th>Time Support</th>
				<th>API Kind</th>
				<th>URL</th>
				<th>Notes</th>
			</tr>
		</thead>
		<tbody>
			<!-- The data rows will be dynamically populated by DataTables -->
		</tbody>
	</table>

	<h2>Metrics</h2>
	<ul>
		<li><b>Iterations</b>: The number of iterations used in the benchmark to reach (approximately) a 1 second run.
		</li>
		<li><b>ns/Op</b>: How long (in nanoseconds) each operation took.</li>
		<li><b>B/Op</b>: The allocation heap size (in bytes) per operation.</li>
		<li><b>allocs/Op</b>: The number of heap allocations per operation.</li>
		<li><b>Serialization Size</b>: The amount of bytes used to encode a marshalled value.</li>
		<li><b>Unsafe Str Unmarshal</b>: Whether unmarshalled strings are safe to use or if their value is modified if
			the underlying backing byte array is modified.</li>
		<li><b>Buffer Reuse Marshal</b>: Whether marshalling reuses its internal buffer for every operation.</li>
		<li><b>Time Support</b>: How the serializer supports time.Time values. Options:
			<ul>
				<li><b>unix-ns</b>: Time since UNIX epoch as an int64, with nanosecond precision.</li>
				<li><b>unix-ms</b>: Time since UNIX epoch as an int64, with millisecond precision.</li>
				<li><b>fullrange</b>: Full time.Time range, without timezone information.</li>
				<li><b>fulltzoffset</b>: Full time.Time range, including timezone offset information.</li>
				<li><b>RFC3339ns</b>: RFC3339 string with nanosecond precision.</li>
				<li><b>custom</b>: Custom encoding and restrictions.</li>
				<li><b>no</b>: No native support for time.Time values (user needs to convert).</li>
				<li><b>unknown</b>: Unknown if/how the serializer encodes time.Time values.</li>
			</ul>
		</li>
		<li><b>API Kind</b>: How user code interacts/uses the serializer library. Options:
			<ul>
				<li><b>reflect</b>: Serializer uses Go's reflection features (no additional code needed).</li>
				<li><b>codegen</b>: Code generation step creates the code to marshal/unmarshal structures.</li>
				<li><b>manual</b>: User must write the code to marshal/unmarshal structures.</li>
			</ul>
		</li>
	</ul>

	<script>
		$(document).ready(function () {
			var toggleColumnsBtn = $('#toggleColumnsBtn');
			var toggleContainer = $('.toggle-container');

			toggleColumnsBtn.on('click', function () {
				toggleContainer.toggleClass('collapsed');
				if (toggleContainer.hasClass('collapsed')) {
					toggleColumnsBtn.text('Filter Benchmarks');
				} else {
					toggleColumnsBtn.text('Hide');
				}
			});

			var table = $('#benchmarkResults').DataTable({
				data: data,
				pageLength: 25,
				order: [[4, 'asc']],
				columns: [
					{ data: 'name' },
					{ data: 'total_iter_count' },
					{ data: 'marshal_iter_count', visible: false },
					{ data: 'unmarshal_iter_count', visible: false },
					{ data: 'total_ns_op' },
					{ data: 'marshal_ns_op', visible: false },
					{ data: 'unmarshal_ns_op', visible: false },
					{ data: 'total_alloc_bytes' },
					{ data: 'marshal_alloc_bytes', visible: false },
					{ data: 'unmarshal_alloc_bytes', visible: false },
					{ data: 'total_allocs' },
					{ data: 'marshal_allocs', visible: false },
					{ data: 'unmarshal_allocs', visible: false },
					{ data: 'serialization_size' },
					{
						data: 'unsafe_string_unmarshal',
						render: function (data, type, row) {
							return data ? 'Yes' : 'No';
						}
					},
					{
						data: 'buffer_reuse_marshal',
						render: function (data, type, row) {
							return data ? 'Yes' : 'No';
						}
					},
					{ data: 'time_support' },
					{ data: 'api_kind' },
					{ data: 'url' },
					{ data: 'notes' }
				],
				createdRow: function (row, data, dataIndex) {
					if (data.unsafe_string_unmarshal) {
						$(row).addClass('has-unsafe');
						$('td', row).eq(6).addClass('yes');
					} else {
						$('td', row).eq(6).addClass('no');
					}
					if (data.buffer_reuse_marshal) {
						$(row).addClass('has-buffer');
						$('td', row).eq(7).addClass('yes');
					} else {
						$('td', row).eq(7).addClass('no');
					}
				},
				rowCallback: function (row, data, dataIndex) {
					var showUnsafe = $('#filterUnsafe').prop('checked');
					var showBuffer = $('#filterBuffer').prop('checked');
					var timeFilter = $('#timeSupportFilter').val();
					var apiFilter = $('#apiKindFilter').val();
					var hasUnsafe = $(row).hasClass('has-unsafe');
					var hasBuffer = $(row).hasClass('has-buffer');

					if ((!showUnsafe && hasUnsafe) || (!showBuffer && hasBuffer)) {
						$(row).hide();
					} else if ((timeFilter && data.time_support !== timeFilter) || (apiFilter && data.api_kind !== apiFilter)) {
						$(row).hide();
					} else {
						$(row).show();
					}
				}
			});

			$('input[type="checkbox"]').on('change', function (e) {
				var $this = $(this);
				if ($this.attr('id') === 'filterUnsafe' || $this.attr('id') === 'filterBuffer') {
					table.rows().invalidate().draw();
				} else {
					var column = table.column($this.attr('data-column'));
					column.visible($this.prop('checked'));
				}
			});

			$('#filterUnsafe, #filterBuffer').on('change', function () {
				table.rows().invalidate().draw();
			});

			$('#timeSupportFilter, #apiKindFilter').on('change', function () {
				table.rows().invalidate().draw();
			});

			$('#filterUnsafe').prop('checked', false);
			$('#filterBuffer').prop('checked', false);

			// Initialize DataTable filtering based on initial checkbox states
			table.rows().invalidate().draw();
		});
	</script>
</body>

</html>